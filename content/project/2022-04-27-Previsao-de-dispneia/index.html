---
author: Saulo Gil
categories:
- Theme Features
- R
- package
date: "2024-01-06"
draft: false
excerpt: This project used XGboost to predict dyspnea in COVID-19 survivors 6-9 months after hospital discharge. 
  websites.
featured: true
layout: single-sidebar
subtitle: "In progress"
tags:
- hugo-site
title: Using XGboost to Predict Dyspnea in COVID-19 Survivors
---

<script src="{{< blogdown/postref >}}index_files/htmlwidgets/htmlwidgets.js"></script>
<link href="{{< blogdown/postref >}}index_files/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index_files/datatables-binding/datatables.js"></script>
<script src="{{< blogdown/postref >}}index_files/jquery/jquery-3.6.0.min.js"></script>
<link href="{{< blogdown/postref >}}index_files/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="{{< blogdown/postref >}}index_files/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index_files/dt-core/js/jquery.dataTables.min.js"></script>
<link href="{{< blogdown/postref >}}index_files/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index_files/crosstalk/js/crosstalk.min.js"></script>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Dispnea is a medical term that refers to the sensation of shortness of breath or difficulty breathing 1. It is a common symptom of heart and lung diseases, such as asthma, pneumonia, and chronic obstructive pulmonary disease (COPD).</p>
<p>In the context of COVID-19, dyspnea is one of the most common symptoms experienced by infected individuals, but it remains even after acute COVID-19 is solved. According to a study published in BMC Pulmonary Medicine, 45% of COVID-19 pneumonia survivors admitted to the hospital experience dyspnea even after 1 year from hospital discharge. In this sense, identifying patients at risk of presenting dyspnea is crucial for early management.</p>
<p>XGBoost (eXtreme Gradient Boosting) is a very popular ML algorithm. Its popularity is due to the fact that has recently been dominating applied machine learning and Kaggle competitions for structured or tabular data. Therefore, the implementation of ML algorithm XGBoost in clinical setting may be useful for predicting COVID-19 survivors at the risk of dyspnea following discharge.</p>
<p>Herein, we utilized the XGBoost to predict dyspnea in COVID-19 survivors 6-9 months after hospital discharge</p>
<div id="packages" class="section level2">
<h2>Packages</h2>
<pre class="r"><code># Pacotes
library(tidyverse)
library(tidymodels)
library(GGally)
library(DataExplorer)
library(vip)
library(doParallel)</code></pre>
</div>
<div id="reading-dataset" class="section level2">
<h2>Reading dataset</h2>
<p>The dataset consist in a real dataset collected in the largest tertiary hospital of Latin America (Clinical Hospital, School of Medicine of the University of Sao Paulo).</p>
<pre class="r"><code># Lendo a base
dispneia &lt;- read.csv2(&#39;df_ajustada.csv&#39;)</code></pre>
</div>
<div id="spliting-dataset---traintest" class="section level2">
<h2>Spliting dataset - Train/Test</h2>
<p>Since our dataset is size-limited, I opted to separate 80% of the sample size for training.</p>
<pre class="r"><code>set.seed(32)

dispneia_initial_split &lt;- initial_split(dispneia,
                                        prop = 0.8,
                                        strata = &quot;dispneia&quot;)
dispneia_initial_split</code></pre>
<pre><code>## &lt;Training/Testing/Total&gt;
## &lt;592/149/741&gt;</code></pre>
<pre class="r"><code># train and test datasets
dispneia_train &lt;- training(dispneia_initial_split)

dispneia_test &lt;- testing(dispneia_initial_split)</code></pre>
</div>
<div id="exploratory-analysis" class="section level2">
<h2>Exploratory analysis</h2>
<div id="overview" class="section level3">
<h3>Overview</h3>
<pre class="r"><code>skimr::skim(dispneia_train)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-4">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">dispneia_train</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">592</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">47</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">42</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table style="width:100%;">
<colgroup>
<col width="40%" />
<col width="10%" />
<col width="14%" />
<col width="4%" />
<col width="4%" />
<col width="6%" />
<col width="9%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">idade</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">sexo</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">adm_uti</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">tempo_uti</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">9</td>
<td align="right">16</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">vmi</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">tempo_vmi</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">9</td>
<td align="right">17</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">dispneia</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">tosse</td>
<td align="right">13</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">fraqueza</td>
<td align="right">7</td>
<td align="right">0.99</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">dific_caminhar</td>
<td align="right">7</td>
<td align="right">0.99</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">angina</td>
<td align="right">21</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">dor_articular</td>
<td align="right">12</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">dor_abdominal</td>
<td align="right">12</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">diarreia</td>
<td align="right">14</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">nausea</td>
<td align="right">9</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">perda_consciencia</td>
<td align="right">12</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">inapetencia</td>
<td align="right">7</td>
<td align="right">0.99</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">parestesia</td>
<td align="right">8</td>
<td align="right">0.99</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">obstrucao_nasal</td>
<td align="right">16</td>
<td align="right">0.97</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">perda_paladar</td>
<td align="right">25</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">anosmia</td>
<td align="right">18</td>
<td align="right">0.97</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">fadiga</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">cefaleia</td>
<td align="right">7</td>
<td align="right">0.99</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">trail_making_a_persistent_fup_incident</td>
<td align="right">73</td>
<td align="right">0.88</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">perda_memoria</td>
<td align="right">47</td>
<td align="right">0.92</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">TEPT</td>
<td align="right">11</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">perda_auditiva</td>
<td align="right">11</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">ruido_ouvido</td>
<td align="right">10</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">vertigem</td>
<td align="right">9</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">edema</td>
<td align="right">14</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">nocturia</td>
<td align="right">15</td>
<td align="right">0.97</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">dor_corpo</td>
<td align="right">9</td>
<td align="right">0.98</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">insonia</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">depressao</td>
<td align="right">64</td>
<td align="right">0.89</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">ansiedade</td>
<td align="right">64</td>
<td align="right">0.89</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">tempo_internacao</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">tabagismo</td>
<td align="right">4</td>
<td align="right">0.99</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">obesidade</td>
<td align="right">2</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">hipertensao</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">diabetes</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">gravidade_adm</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">nivel_atf</td>
<td align="right">3</td>
<td align="right">0.99</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table style="width:100%;">
<colgroup>
<col width="23%" />
<col width="11%" />
<col width="15%" />
<col width="7%" />
<col width="6%" />
<col width="3%" />
<col width="6%" />
<col width="4%" />
<col width="7%" />
<col width="5%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">espiro_cvf_pred</td>
<td align="right">86</td>
<td align="right">0.85</td>
<td align="right">83.46</td>
<td align="right">16.51</td>
<td align="right">22</td>
<td align="right">73.00</td>
<td align="right">84</td>
<td align="right">94.00</td>
<td align="right">132</td>
<td align="left">▁▂▇▆▁</td>
</tr>
<tr class="even">
<td align="left">espiro_cvf_vef1_pred</td>
<td align="right">86</td>
<td align="right">0.85</td>
<td align="right">101.78</td>
<td align="right">9.91</td>
<td align="right">43</td>
<td align="right">97.00</td>
<td align="right">103</td>
<td align="right">107.00</td>
<td align="right">129</td>
<td align="left">▁▁▂▇▂</td>
</tr>
<tr class="odd">
<td align="left">espiro_vef_pred</td>
<td align="right">86</td>
<td align="right">0.85</td>
<td align="right">84.90</td>
<td align="right">17.61</td>
<td align="right">21</td>
<td align="right">75.00</td>
<td align="right">87</td>
<td align="right">96.00</td>
<td align="right">140</td>
<td align="left">▁▂▇▅▁</td>
</tr>
<tr class="even">
<td align="left">espiro_pefr_pred</td>
<td align="right">87</td>
<td align="right">0.85</td>
<td align="right">74.68</td>
<td align="right">22.88</td>
<td align="right">9</td>
<td align="right">60.00</td>
<td align="right">76</td>
<td align="right">91.00</td>
<td align="right">133</td>
<td align="left">▁▃▇▆▂</td>
</tr>
<tr class="odd">
<td align="left">espiro_fef_pred</td>
<td align="right">86</td>
<td align="right">0.85</td>
<td align="right">101.74</td>
<td align="right">39.00</td>
<td align="right">0</td>
<td align="right">75.25</td>
<td align="right">100</td>
<td align="right">125.75</td>
<td align="right">282</td>
<td align="left">▂▇▆▁▁</td>
</tr>
</tbody>
</table>
</div>
<div id="missing-values" class="section level3">
<h3>Missing values</h3>
<pre class="r"><code>plot_missing(dispneia_train)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" width="1344" /></p>
</div>
</div>
<div id="checking-the-correlation-and-distribution-of-numerical-features" class="section level2">
<h2>Checking the correlation and distribution of numerical features</h2>
<pre class="r"><code>dispneia_train |&gt;  
  select(where(is.numeric)) |&gt;  
  cor(use = &quot;pairwise.complete.obs&quot;) |&gt; 
  corrplot::corrplot(method = &quot;number&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-6-1.png" width="100%" /></p>
<pre class="r"><code>dispneia_train |&gt;  
  select(where(is.numeric), dispneia) |&gt; 
  ggpairs(aes(colour = dispneia))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="1344" /></p>
<pre class="r"><code>dispneia_train |&gt;  
  select(c(where(is.numeric), dispneia)) |&gt; 
  pivot_longer(-dispneia, 
               names_to = &quot;Feature&quot;,
               values_to = &quot;Value&quot;) |&gt; 
  ggplot(aes(y = dispneia, 
             x = Value, 
             fill = dispneia)) +
  geom_boxplot() +
  facet_wrap(~Feature,
             scales = &quot;free_x&quot;) +
  ggtitle(&quot;Dyspnea vs. Numeric Features&quot;)</code></pre>
<pre><code>## Warning: Removed 431 rows containing non-finite values (`stat_boxplot()`).</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-1.png" width="1536" /></p>
<pre class="r"><code>dispneia_train |&gt;  
  select(c(where(is.numeric), dispneia)) |&gt; 
  pivot_longer(-dispneia, 
               names_to = &quot;Feature&quot;,
               values_to = &quot;Value&quot;) |&gt; 
  ggplot(aes(x = Value, 
             colour = dispneia)) +
  stat_ecdf() +
  facet_wrap(~Feature, scales = &quot;free_x&quot;) +
  labs(title = &quot;Dyspnea vs. Numeric Features&quot;,
       subtitle = &quot;Cumulative Distribution&quot;)</code></pre>
<pre><code>## Warning: Removed 431 rows containing non-finite values (`stat_ecdf()`).</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="1536" /></p>
<pre class="r"><code>grafico_de_barras_das_vars_continuas &lt;- 
  function(dados) {
    dados |&gt;  
    select(c(where(is.numeric), dispneia)) |&gt; 
    pivot_longer(-dispneia,
                 names_to = &quot;Feature&quot;,
                 values_to = &quot;Value&quot;) |&gt; 
    dplyr::group_by(Feature) |&gt; 
    dplyr::mutate(
      Value = factor(dplyr::ntile(Value, 10),
                     levels = 1:10)
    ) |&gt; 
    dplyr::count(dispneia, 
                 Feature,
                 Value) |&gt; 
    ggplot(aes(y = (Value),
               x = n,
               fill = dispneia)) +
    geom_col(position = &quot;fill&quot;) +
    geom_label(aes(label = n),
               position = position_fill(vjust = 0.5)) +
    facet_wrap(~Feature,
               scales = &quot;free_y&quot;,
               ncol = 3) +
    ggtitle(&quot;Dyspnea vs. Numeric Features&quot;)
}

grafico_de_barras_das_vars_continuas(dispneia_train)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="1536" /></p>
</div>
<div id="checking-the-distribution-of-categorical-features" class="section level2">
<h2>Checking the distribution of categorical features</h2>
<pre class="r"><code>contagens &lt;- 
  dispneia_train |&gt;  
  select(c(where(is.character),
           dispneia)) |&gt; 
  pivot_longer(-dispneia,
               names_to = &quot;Feature&quot;,
               values_to = &quot;Value&quot;) |&gt; 
  count(dispneia,
        Feature,
        Value)

# tabela
contagens |&gt; 
  pivot_wider(names_from = dispneia,
              values_from = n) |&gt; 
  DT::datatable()</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115"],["TEPT","TEPT","TEPT","adm_uti","adm_uti","angina","angina","angina","anosmia","anosmia","anosmia","ansiedade","ansiedade","ansiedade","cefaleia","cefaleia","cefaleia","depressao","depressao","depressao","diabetes","diabetes","diarreia","diarreia","diarreia","dific_caminhar","dific_caminhar","dific_caminhar","dor_abdominal","dor_abdominal","dor_abdominal","dor_articular","dor_articular","dor_articular","dor_corpo","dor_corpo","dor_corpo","edema","edema","edema","fadiga","fadiga","fraqueza","fraqueza","fraqueza","gravidade_adm","gravidade_adm","gravidade_adm","gravidade_adm","hipertensao","hipertensao","idade","idade","inapetencia","inapetencia","inapetencia","insonia","insonia","nausea","nausea","nausea","nivel_atf","nivel_atf","nivel_atf","nocturia","nocturia","nocturia","obesidade","obesidade","obesidade","obstrucao_nasal","obstrucao_nasal","obstrucao_nasal","parestesia","parestesia","parestesia","perda_auditiva","perda_auditiva","perda_auditiva","perda_consciencia","perda_consciencia","perda_consciencia","perda_memoria","perda_memoria","perda_memoria","perda_paladar","perda_paladar","perda_paladar","ruido_ouvido","ruido_ouvido","ruido_ouvido","sexo","sexo","tabagismo","tabagismo","tabagismo","tempo_internacao","tempo_internacao","tempo_uti","tempo_uti","tempo_uti","tempo_vmi","tempo_vmi","tempo_vmi","tosse","tosse","tosse","trail_making_a_persistent_fup_incident","trail_making_a_persistent_fup_incident","trail_making_a_persistent_fup_incident","vertigem","vertigem","vertigem","vmi","vmi"],["No","Yes",null,"No","Yes","No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes","No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes","No","Yes",null,"baixa","critico","elevada","moderada","No","Yes","idoso","nao-idoso","No","Yes",null,"No","Yes","No","Yes",null,"ativo","inativo",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes",null,"female","male","No","Yes",null,"&gt; 15 dias","ate 15 dias","&gt; 15 dias","ate 15 dias","não foi para UTI","&gt; 15 dias","Não fez uso de VM","ate 15 dias","No","Yes",null,"No","Yes",null,"No","Yes",null,"No","Yes"],[280,129,8,160,257,336,65,16,338,64,15,302,70,45,372,40,5,311,61,45,273,144,386,17,14,368,44,5,359,49,9,276,129,12,298,110,9,346,59,12,314,103,362,50,5,52,178,15,172,181,236,161,256,381,30,6,309,108,398,10,9,173,242,2,318,86,13,343,73,1,348,57,12,346,65,6,353,53,11,399,12,6,280,103,34,329,68,20,355,52,10,177,240,267,148,2,188,229,81,176,160,27,259,131,337,67,13,243,122,52,281,127,9,239,178],[93,79,3,82,93,125,45,5,115,57,3,82,74,19,152,21,2,97,59,19,109,66,155,20,null,147,26,2,139,33,3,65,110,null,91,84,null,128,45,2,51,124,140,33,2,18,63,8,86,63,112,78,97,126,48,1,89,86,165,10,null,43,131,1,119,54,2,133,41,1,134,37,4,138,35,2,139,36,null,162,7,6,72,90,13,108,62,5,139,36,null,108,67,99,74,2,70,105,26,67,82,12,125,38,131,44,null,78,76,21,91,84,null,112,63]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Feature<\/th>\n      <th>Value<\/th>\n      <th>No<\/th>\n      <th>Yes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>contagens |&gt; 
  ggplot(aes(y = Value,
             x = n,
             fill = dispneia)) +
  geom_col(position = &quot;fill&quot;) +
  geom_label(aes(label = n),
             position = position_fill(vjust = 0.5)) +
  facet_wrap(~Feature,
             scales = &quot;free_y&quot;,
             ncol = 3) +
  ggtitle(&quot;Dyspnea vs. Categorical Features&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-12-1.png" width="1536" /></p>
</div>
<div id="preprocessing-and-feature-engineering-steps-using-recipes-package" class="section level2">
<h2>Preprocessing and Feature Engineering Steps using Recipes package</h2>
</div>
</div>
<div id="recipe" class="section level1">
<h1>Recipe</h1>
<p>For numeric features, the values were normalized, multicollineariry higher than 0.8 were removed and missing values were imputed with median.</p>
<p>For nominal features, missing values were imputed with more frequent value, and all features were transformed in a dummy feature.</p>
<p>Features containing only zero were removed.</p>
<p>The processed dataset can be seen below.</p>
<pre class="r"><code>dispneia_recipe &lt;-
  recipe(formula = dispneia ~ ., dispneia_train) |&gt;
  step_normalize(all_numeric_predictors()) |&gt; # normalize all continuous features
  step_corr(all_numeric_predictors(), threshold = .8) |&gt;  # multicollinearity &lt;- r &gt; 0.8
  step_impute_median(all_numeric_predictors()) |&gt;  # Processing missing continuous data - imputing median 
  step_impute_mode(all_nominal_predictors()) |&gt; # Processing missing categorical data - imputing more frequent class
  step_zv(all_predictors()) |&gt;  # removing variables that contain only zero (zero variance filter)
  step_dummy(all_nominal_predictors()) # dummy - nominal predictors

# Checking the result of the recipe (and whether the steps worked!)
dispneia_recipe |&gt; 
    prep() |&gt; 
    bake(new_data = dispneia_train) |&gt; 
    glimpse()</code></pre>
<pre><code>## Rows: 592
## Columns: 50
## $ espiro_cvf_pred                            &lt;dbl&gt; 0.75971560, -0.93614868, -1…
## $ espiro_cvf_vef1_pred                       &lt;dbl&gt; 0.02173529, -0.18006391, 0.…
## $ espiro_pefr_pred                           &lt;dbl&gt; -0.5976043, -2.0833943, 0.2…
## $ espiro_fef_pred                            &lt;dbl&gt; 0.51947489, -1.17275315, -0…
## $ dispneia                                   &lt;fct&gt; No, No, No, No, No, No, No,…
## $ idade_nao.idoso                            &lt;dbl&gt; 1, 0, 1, 0, 1, 0, 1, 0, 0, …
## $ sexo_male                                  &lt;dbl&gt; 1, 0, 1, 1, 1, 1, 0, 1, 0, …
## $ adm_uti_Yes                                &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ tempo_uti_ate.15.dias                      &lt;dbl&gt; 0, 1, 0, 1, 0, 0, 0, 1, 1, …
## $ tempo_uti_não.foi.para.UTI                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ vmi_Yes                                    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, …
## $ tempo_vmi_ate.15.dias                      &lt;dbl&gt; 0, 1, 0, 1, 0, 1, 1, 0, 0, …
## $ tempo_vmi_Não.fez.uso.de.VM                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 1, …
## $ tosse_Yes                                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ fraqueza_Yes                               &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, …
## $ dific_caminhar_Yes                         &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, …
## $ angina_Yes                                 &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 1, 0, 0, …
## $ dor_articular_Yes                          &lt;dbl&gt; 1, 1, 1, 0, 0, 0, 1, 0, 0, …
## $ dor_abdominal_Yes                          &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, …
## $ diarreia_Yes                               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ nausea_Yes                                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ perda_consciencia_Yes                      &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, …
## $ inapetencia_Yes                            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ parestesia_Yes                             &lt;dbl&gt; 1, 0, 1, 0, 0, 1, 0, 0, 0, …
## $ obstrucao_nasal_Yes                        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, …
## $ perda_paladar_Yes                          &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, …
## $ anosmia_Yes                                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ fadiga_Yes                                 &lt;dbl&gt; 0, 1, 0, 1, 1, 0, 1, 0, 0, …
## $ cefaleia_Yes                               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ trail_making_a_persistent_fup_incident_Yes &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 1, 0, 0, …
## $ perda_memoria_Yes                          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 1, …
## $ TEPT_Yes                                   &lt;dbl&gt; 0, 0, 1, 1, 0, 0, 1, 0, 0, …
## $ perda_auditiva_Yes                         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ ruido_ouvido_Yes                           &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 1, 0, 0, …
## $ vertigem_Yes                               &lt;dbl&gt; 0, 1, 1, 1, 0, 0, 0, 0, 0, …
## $ edema_Yes                                  &lt;dbl&gt; 1, 0, 0, 0, 0, 1, 1, 0, 0, …
## $ nocturia_Yes                               &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 1, 1, 0, …
## $ dor_corpo_Yes                              &lt;dbl&gt; 0, 0, 0, 0, 1, 1, 1, 1, 1, …
## $ insonia_Yes                                &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 1, 0, 1, …
## $ depressao_Yes                              &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 0, …
## $ ansiedade_Yes                              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ tempo_internacao_ate.15.dias               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, …
## $ tabagismo_Yes                              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, …
## $ obesidade_Yes                              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ hipertensao_Yes                            &lt;dbl&gt; 1, 1, 0, 1, 1, 1, 1, 0, 1, …
## $ diabetes_Yes                               &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ gravidade_adm_critico                      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 0, …
## $ gravidade_adm_elevada                      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ gravidade_adm_moderada                     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, …
## $ nivel_atf_inativo                          &lt;dbl&gt; 0, 1, 1, 1, 0, 1, 0, 1, 1, …</code></pre>
<div id="definition-of-cross-validation" class="section level2">
<h2>Definition of cross-validation</h2>
<pre class="r"><code>dispneia_resamples &lt;- 
  vfold_cv(dispneia_train,
           v = 5, 
           strata = dispneia) # 5 folds

dispneia_resamples$splits</code></pre>
<pre><code>## [[1]]
## &lt;Analysis/Assess/Total&gt;
## &lt;473/119/592&gt;
## 
## [[2]]
## &lt;Analysis/Assess/Total&gt;
## &lt;473/119/592&gt;
## 
## [[3]]
## &lt;Analysis/Assess/Total&gt;
## &lt;474/118/592&gt;
## 
## [[4]]
## &lt;Analysis/Assess/Total&gt;
## &lt;474/118/592&gt;
## 
## [[5]]
## &lt;Analysis/Assess/Total&gt;
## &lt;474/118/592&gt;</code></pre>
</div>
<div id="modeling" class="section level2">
<h2>Modeling</h2>
</div>
<div id="xgboost" class="section level2">
<h2>XGBoost</h2>
<p>The hyperameters tuned were:</p>
<ul>
<li>boost_tree;</li>
<li>min_n: An integer for the minimum number of data points in a node that is required for the node to be split further;</li>
<li>mtry: A number for the number (or proportion) of predictors that will be randomly sampled at each split when creating the tree models (specific engines only);</li>
<li>trees: An integer for the number of trees contained in the ensemble;</li>
<li>tree_depth: An integer for the maximum depth of the tree (i.e. number of splits) (specific engines only);</li>
<li>learn_rate: A number for the rate at which the boosting algorithm adapts from iteration-to-iteration (specific engines only). This is sometimes referred to as the shrinkage parameter;</li>
<li>loss_reduction: A number for the reduction in the loss function required to split further (specific engines only);</li>
<li>sample_size: A number for the number (or proportion) of data that is exposed to the fitting routine. For xgboost, the sampling is done at each iteration while C5.0 samples once during training.</li>
</ul>
<p>The tuning process were done in 5 steps.</p>
<div id="step-1---number-of-trees-trees-and-learn-rate-learn_rate" class="section level3">
<h3>Step 1 - Number of trees (trees) and learn rate (learn_rate)</h3>
</div>
<div id="model" class="section level3">
<h3>Model</h3>
<pre class="r"><code># Modelo
dispneia_xgb_model &lt;-
  boost_tree(
  min_n = 15,
  mtry = 0.8,
  trees = tune(),
  tree_depth = 5,
  learn_rate = tune(),
  loss_reduction = 0,
  sample_size = 0.8
) |&gt;
  set_mode(&quot;classification&quot;) |&gt;
  set_engine(&quot;xgboost&quot;, count = FALSE)</code></pre>
</div>
<div id="workflow" class="section level3">
<h3>Workflow</h3>
<pre class="r"><code># Workflow
dispneia_xgb_wf &lt;- 
  workflow() |&gt; 
  add_model(dispneia_xgb_model) |&gt; 
  add_recipe(dispneia_recipe)</code></pre>
</div>
<div id="tuning" class="section level3">
<h3>Tuning</h3>
<pre class="r"><code># Tune
dispneia_grid_xgb &lt;-
  expand.grid(
    trees = seq(25, 800, 25),
    learn_rate = seq(0.01, 0.4,0.1)
)

dispneia_grid_xgb |&gt; 
  DT::datatable()</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128"],[25,50,75,100,125,150,175,200,225,250,275,300,325,350,375,400,425,450,475,500,525,550,575,600,625,650,675,700,725,750,775,800,25,50,75,100,125,150,175,200,225,250,275,300,325,350,375,400,425,450,475,500,525,550,575,600,625,650,675,700,725,750,775,800,25,50,75,100,125,150,175,200,225,250,275,300,325,350,375,400,425,450,475,500,525,550,575,600,625,650,675,700,725,750,775,800,25,50,75,100,125,150,175,200,225,250,275,300,325,350,375,400,425,450,475,500,525,550,575,600,625,650,675,700,725,750,775,800],[0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.11,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.21,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001,0.3100000000000001]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>trees<\/th>\n      <th>learn_rate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>doParallel::registerDoParallel(4)

dispneia_xgb_tune_grid &lt;-
  tune_grid(
  dispneia_xgb_wf,
  resamples = dispneia_resamples,
  grid = dispneia_grid_xgb,
  metrics = metric_set(roc_auc, accuracy, sensitivity, specificity),
  verbose = TRUE
  )</code></pre>
<pre class="r"><code>autoplot(dispneia_xgb_tune_grid) +
  theme_bw() +
  theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-19-1.png" width="100%" /></p>
<pre class="r"><code>collect_metrics(dispneia_xgb_tune_grid) |&gt; 
  filter(.metric == &quot;roc_auc&quot;) |&gt; 
  filter(mean == max(mean))</code></pre>
<pre><code>## # A tibble: 1 × 8
##   trees learn_rate .metric .estimator  mean     n std_err .config               
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 
## 1   100       0.11 roc_auc binary     0.810     5  0.0163 Preprocessor1_Model036</code></pre>
<pre class="r"><code>dispneia_xgb_tune_grid |&gt; 
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre><code>## # A tibble: 1 × 3
##   trees learn_rate .config               
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                 
## 1   100       0.11 Preprocessor1_Model036</code></pre>
<pre class="r"><code>show_best(dispneia_xgb_tune_grid, n = 6)</code></pre>
<pre><code>## # A tibble: 6 × 8
##   trees learn_rate .metric .estimator  mean     n std_err .config               
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 
## 1   100       0.11 roc_auc binary     0.810     5  0.0163 Preprocessor1_Model036
## 2   125       0.11 roc_auc binary     0.810     5  0.0161 Preprocessor1_Model037
## 3    75       0.11 roc_auc binary     0.810     5  0.0163 Preprocessor1_Model035
## 4   700       0.01 roc_auc binary     0.810     5  0.0166 Preprocessor1_Model028
## 5   750       0.01 roc_auc binary     0.809     5  0.0162 Preprocessor1_Model030
## 6   775       0.01 roc_auc binary     0.809     5  0.0164 Preprocessor1_Model031</code></pre>
<pre class="r"><code>dispneia_best_step1 &lt;-
  dispneia_xgb_tune_grid |&gt;
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre class="r"><code># best hiperparameters
glue::glue(&quot;The best number of trees was {dispneia_best_step1$trees} and learn_rate was {dispneia_best_step1$learn_rate}.&quot;)</code></pre>
<pre><code>## The best number of trees was 100 and learn_rate was 0.11.</code></pre>
</div>
<div id="step-2---minimal-node-size-min_n-and-depth-tree-tree_depth" class="section level3">
<h3>Step 2 - Minimal node size (min_n) and depth tree (tree_depth)</h3>
</div>
<div id="model-1" class="section level3">
<h3>Model</h3>
<pre class="r"><code># Modelo
dispneia_xgb_model &lt;-
  boost_tree(
  min_n = tune(),
  mtry = 0.8,
  trees = 25,
  tree_depth = tune(),
  learn_rate = 0.31,
  loss_reduction = 0,
  sample_size = 0.8
) |&gt;
  set_mode(&quot;classification&quot;) |&gt;
  set_engine(&quot;xgboost&quot;, count = FALSE)</code></pre>
</div>
<div id="workflow-1" class="section level3">
<h3>Workflow</h3>
<pre class="r"><code># Workflow
dispneia_xgb_wf &lt;- 
  workflow() |&gt; 
  add_model(dispneia_xgb_model) |&gt; 
  add_recipe(dispneia_recipe)</code></pre>
</div>
<div id="tuning-1" class="section level3">
<h3>Tuning</h3>
<pre class="r"><code># Tune - min_n and tree_depth
dispneia_grid_xgb &lt;-
  expand.grid(
    min_n = seq(1,16,2),
    tree_depth = seq(1,17,4)
)

dispneia_grid_xgb |&gt; 
  DT::datatable()</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40"],[1,3,5,7,9,11,13,15,1,3,5,7,9,11,13,15,1,3,5,7,9,11,13,15,1,3,5,7,9,11,13,15,1,3,5,7,9,11,13,15],[1,1,1,1,1,1,1,1,5,5,5,5,5,5,5,5,9,9,9,9,9,9,9,9,13,13,13,13,13,13,13,13,17,17,17,17,17,17,17,17]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>min_n<\/th>\n      <th>tree_depth<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>doParallel::registerDoParallel(4)

dispneia_xgb_tune_grid &lt;-
  tune_grid(
  dispneia_xgb_wf,
  resamples = dispneia_resamples,
  grid = dispneia_grid_xgb,
  metrics = metric_set(roc_auc, accuracy, sensitivity, specificity),
  verbose = TRUE
  )</code></pre>
<pre class="r"><code>autoplot(dispneia_xgb_tune_grid) +
  theme_bw() +
  theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-25-1.png" width="100%" /></p>
<pre class="r"><code>collect_metrics(dispneia_xgb_tune_grid) |&gt; 
  filter(.metric == &quot;roc_auc&quot;) |&gt; 
  filter(mean == max(mean))</code></pre>
<pre><code>## # A tibble: 1 × 8
##   min_n tree_depth .metric .estimator  mean     n std_err .config              
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1     5          1 roc_auc binary     0.818     5  0.0209 Preprocessor1_Model03</code></pre>
<pre class="r"><code>dispneia_xgb_tune_grid |&gt; 
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre><code>## # A tibble: 1 × 3
##   min_n tree_depth .config              
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                
## 1     5          1 Preprocessor1_Model03</code></pre>
<pre class="r"><code>show_best(dispneia_xgb_tune_grid, n = 6)</code></pre>
<pre><code>## # A tibble: 6 × 8
##   min_n tree_depth .metric .estimator  mean     n std_err .config              
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1     5          1 roc_auc binary     0.818     5  0.0209 Preprocessor1_Model03
## 2     7          1 roc_auc binary     0.814     5  0.0213 Preprocessor1_Model04
## 3     9         13 roc_auc binary     0.813     5  0.0161 Preprocessor1_Model29
## 4     9          5 roc_auc binary     0.813     5  0.0148 Preprocessor1_Model13
## 5    15         13 roc_auc binary     0.813     5  0.0153 Preprocessor1_Model32
## 6     1          1 roc_auc binary     0.813     5  0.0213 Preprocessor1_Model01</code></pre>
<pre class="r"><code>dispneia_best_step2 &lt;-
  dispneia_xgb_tune_grid |&gt;
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre class="r"><code># best hiperparameters
glue::glue(&quot;The best minimal node size was {dispneia_best_step2$min_n} and depth tree was {dispneia_best_step2$tree_depth}.&quot;)</code></pre>
<pre><code>## The best minimal node size was 5 and depth tree was 1.</code></pre>
</div>
<div id="step-3---number-for-the-reduction-in-the-loss-function-required-to-split-further-loss_reduction" class="section level3">
<h3>Step 3 - Number for the reduction in the loss function required to split further (loss_reduction)</h3>
</div>
<div id="model-2" class="section level3">
<h3>Model</h3>
<pre class="r"><code># Modelo
dispneia_xgb_model &lt;-
  boost_tree(
  min_n = 11,
  mtry = 0.8,
  trees = 25,
  tree_depth = 1,
  learn_rate = 0.31,
  loss_reduction = tune(),
  sample_size = 0.8
) |&gt;
  set_mode(&quot;classification&quot;) |&gt;
  set_engine(&quot;xgboost&quot;, count = FALSE)</code></pre>
</div>
<div id="workflow-2" class="section level3">
<h3>Workflow</h3>
<pre class="r"><code># Workflow
dispneia_xgb_wf &lt;- 
  workflow() |&gt; 
  add_model(dispneia_xgb_model) |&gt; 
  add_recipe(dispneia_recipe)</code></pre>
</div>
<div id="tuning-2" class="section level3">
<h3>Tuning</h3>
<pre class="r"><code># Tune - min_n and tree_depth
dispneia_grid_xgb &lt;-
  expand.grid(
    loss_reduction = seq(1, 4, 0.04)
)

dispneia_grid_xgb |&gt; 
  DT::datatable()</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76"],[1,1.04,1.08,1.12,1.16,1.2,1.24,1.28,1.32,1.36,1.4,1.44,1.48,1.52,1.56,1.6,1.64,1.68,1.72,1.76,1.8,1.84,1.88,1.92,1.96,2,2.04,2.08,2.12,2.16,2.2,2.24,2.28,2.32,2.36,2.4,2.44,2.48,2.52,2.56,2.6,2.64,2.68,2.72,2.76,2.8,2.84,2.88,2.92,2.96,3,3.04,3.08,3.12,3.16,3.2,3.24,3.28,3.32,3.36,3.4,3.44,3.48,3.52,3.56,3.6,3.64,3.68,3.72,3.76,3.8,3.84,3.88,3.92,3.96,4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>loss_reduction<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>doParallel::registerDoParallel(4)

dispneia_xgb_tune_grid &lt;-
  tune_grid(
  dispneia_xgb_wf,
  resamples = dispneia_resamples,
  grid = dispneia_grid_xgb,
  metrics = metric_set(roc_auc, accuracy, sensitivity, specificity),
  verbose = TRUE
  )</code></pre>
<pre class="r"><code>autoplot(dispneia_xgb_tune_grid) +
  theme_bw() </code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-31-1.png" width="100%" /></p>
<pre class="r"><code>collect_metrics(dispneia_xgb_tune_grid) |&gt; 
  filter(.metric == &quot;roc_auc&quot;) |&gt; 
  filter(mean == max(mean))</code></pre>
<pre><code>## # A tibble: 1 × 7
##   loss_reduction .metric .estimator  mean     n std_err .config              
##            &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1           1.88 roc_auc binary     0.820     5  0.0195 Preprocessor1_Model23</code></pre>
<pre class="r"><code>dispneia_xgb_tune_grid |&gt; 
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre><code>## # A tibble: 1 × 2
##   loss_reduction .config              
##            &lt;dbl&gt; &lt;chr&gt;                
## 1           1.88 Preprocessor1_Model23</code></pre>
<pre class="r"><code>show_best(dispneia_xgb_tune_grid, n = 6)</code></pre>
<pre><code>## Warning: No value of `metric` was given; metric &#39;roc_auc&#39; will be used.</code></pre>
<pre><code>## # A tibble: 6 × 7
##   loss_reduction .metric .estimator  mean     n std_err .config              
##            &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1           1.88 roc_auc binary     0.820     5  0.0195 Preprocessor1_Model23
## 2           3.76 roc_auc binary     0.819     5  0.0168 Preprocessor1_Model70
## 3           3.12 roc_auc binary     0.819     5  0.0207 Preprocessor1_Model54
## 4           1.92 roc_auc binary     0.819     5  0.0206 Preprocessor1_Model24
## 5           2.64 roc_auc binary     0.818     5  0.0205 Preprocessor1_Model42
## 6           2    roc_auc binary     0.816     5  0.0205 Preprocessor1_Model26</code></pre>
<pre class="r"><code>dispneia_best_step3 &lt;-
  dispneia_xgb_tune_grid |&gt;
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre class="r"><code># best hiperparameters
glue::glue(&quot;The best loss_reduction was {dispneia_best_step3$loss_reduction}.&quot;)</code></pre>
<pre><code>## The best loss_reduction was 1.88.</code></pre>
</div>
<div id="step-4---number-or-proportion-of-predictors-that-will-be-randomly-sampled-mtry-and-number-or-proportion-of-data-that-is-exposed-to-the-fitting-routine-sample_size" class="section level3">
<h3>Step 4 - Number (or proportion) of predictors that will be randomly sampled (mtry) and number (or proportion) of data that is exposed to the fitting routine (sample_size)</h3>
</div>
<div id="model-3" class="section level3">
<h3>Model</h3>
<pre class="r"><code># Modelo
dispneia_xgb_model &lt;-
  boost_tree(
  min_n = 11,
  mtry = tune(),
  trees = 25,
  tree_depth = 1,
  learn_rate = 0.31,
  loss_reduction = 1.36,
  sample_size = tune()
) |&gt;
  set_mode(&quot;classification&quot;) |&gt;
  set_engine(&quot;xgboost&quot;, count = FALSE)</code></pre>
</div>
<div id="workflow-3" class="section level3">
<h3>Workflow</h3>
<pre class="r"><code># Workflow
dispneia_xgb_wf &lt;- 
  workflow() |&gt; 
  add_model(dispneia_xgb_model) |&gt; 
  add_recipe(dispneia_recipe)</code></pre>
</div>
<div id="tuning-3" class="section level3">
<h3>Tuning</h3>
<pre class="r"><code># Tune - min_n and tree_depth
dispneia_grid_xgb &lt;-
  expand.grid(
    mtry = seq(0.2, 1.0, 0.2),
    sample_size = seq(0.2, 1.0,by = 0.2)
)

dispneia_grid_xgb |&gt; 
  DT::datatable()</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25"],[0.2,0.4,0.6000000000000001,0.8,1,0.2,0.4,0.6000000000000001,0.8,1,0.2,0.4,0.6000000000000001,0.8,1,0.2,0.4,0.6000000000000001,0.8,1,0.2,0.4,0.6000000000000001,0.8,1],[0.2,0.2,0.2,0.2,0.2,0.4,0.4,0.4,0.4,0.4,0.6000000000000001,0.6000000000000001,0.6000000000000001,0.6000000000000001,0.6000000000000001,0.8,0.8,0.8,0.8,0.8,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mtry<\/th>\n      <th>sample_size<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>doParallel::registerDoParallel(4)

dispneia_xgb_tune_grid &lt;-
  tune_grid(
  dispneia_xgb_wf,
  resamples = dispneia_resamples,
  grid = dispneia_grid_xgb,
  metrics = metric_set(roc_auc, accuracy, sensitivity, specificity),
  verbose = TRUE
  )</code></pre>
<pre class="r"><code>autoplot(dispneia_xgb_tune_grid) +
  theme_bw() +
  theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-37-1.png" width="100%" /></p>
<pre class="r"><code>collect_metrics(dispneia_xgb_tune_grid) |&gt; 
  filter(.metric == &quot;roc_auc&quot;) |&gt; 
  filter(mean == max(mean))</code></pre>
<pre><code>## # A tibble: 1 × 8
##    mtry sample_size .metric .estimator  mean     n std_err .config              
##   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1   0.6           1 roc_auc binary     0.820     5  0.0217 Preprocessor1_Model23</code></pre>
<pre class="r"><code>dispneia_xgb_tune_grid |&gt; 
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre><code>## # A tibble: 1 × 3
##    mtry sample_size .config              
##   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;                
## 1   0.6           1 Preprocessor1_Model23</code></pre>
<pre class="r"><code>show_best(dispneia_xgb_tune_grid, n = 6)</code></pre>
<pre><code>## Warning: No value of `metric` was given; metric &#39;roc_auc&#39; will be used.</code></pre>
<pre><code>## # A tibble: 6 × 8
##    mtry sample_size .metric .estimator  mean     n std_err .config              
##   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1   0.6         1   roc_auc binary     0.820     5  0.0217 Preprocessor1_Model23
## 2   1           0.8 roc_auc binary     0.819     5  0.0197 Preprocessor1_Model20
## 3   0.4         1   roc_auc binary     0.818     5  0.0218 Preprocessor1_Model22
## 4   0.8         1   roc_auc binary     0.818     5  0.0215 Preprocessor1_Model24
## 5   1           1   roc_auc binary     0.817     5  0.0225 Preprocessor1_Model25
## 6   0.2         1   roc_auc binary     0.812     5  0.0227 Preprocessor1_Model21</code></pre>
<pre class="r"><code>dispneia_best_step4 &lt;-
  dispneia_xgb_tune_grid |&gt;
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre class="r"><code># best hiperparameters
glue::glue(&quot;The best number (or proportion) of predictors that will be randomly sampled (mtry) was {dispneia_best_step4$mtry} and the number (or proportion) of data that is exposed to the fitting routine (sample size) was {dispneia_best_step4$sample_size}.&quot;)</code></pre>
<pre><code>## The best number (or proportion) of predictors that will be randomly sampled (mtry) was 0.6 and the number (or proportion) of data that is exposed to the fitting routine (sample size) was 1.</code></pre>
</div>
<div id="step-5---training-again-learing-rate-and-trees-with-lower-values" class="section level3">
<h3>Step 5 - Training again learing rate and trees with lower values</h3>
</div>
<div id="model-4" class="section level3">
<h3>Model</h3>
<pre class="r"><code># Modelo
dispneia_xgb_model &lt;-
  boost_tree(
  min_n = 11,
  mtry = 0.8,
  trees = tune(),
  tree_depth = 1,
  learn_rate = tune(),
  loss_reduction = 1.36,
  sample_size = 0.8
) |&gt;
  set_mode(&quot;classification&quot;) |&gt;
  set_engine(&quot;xgboost&quot;, count = FALSE)</code></pre>
</div>
<div id="workflow-4" class="section level3">
<h3>Workflow</h3>
<pre class="r"><code># Workflow
dispneia_xgb_wf &lt;- 
  workflow() |&gt; 
  add_model(dispneia_xgb_model) |&gt; 
  add_recipe(dispneia_recipe)</code></pre>
</div>
<div id="tuning-4" class="section level3">
<h3>Tuning</h3>
<pre class="r"><code># Tune - min_n and tree_depth
dispneia_grid_xgb &lt;-
  expand.grid(
    trees = seq(15, 700, 25),
    learn_rate = seq(0.02, 0.1, 0.02)
)

dispneia_grid_xgb |&gt; 
  DT::datatable()</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140"],[15,40,65,90,115,140,165,190,215,240,265,290,315,340,365,390,415,440,465,490,515,540,565,590,615,640,665,690,15,40,65,90,115,140,165,190,215,240,265,290,315,340,365,390,415,440,465,490,515,540,565,590,615,640,665,690,15,40,65,90,115,140,165,190,215,240,265,290,315,340,365,390,415,440,465,490,515,540,565,590,615,640,665,690,15,40,65,90,115,140,165,190,215,240,265,290,315,340,365,390,415,440,465,490,515,540,565,590,615,640,665,690,15,40,65,90,115,140,165,190,215,240,265,290,315,340,365,390,415,440,465,490,515,540,565,590,615,640,665,690],[0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.06,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>trees<\/th>\n      <th>learn_rate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>doParallel::registerDoParallel(4)

dispneia_xgb_tune_grid &lt;-
  tune_grid(
  dispneia_xgb_wf,
  resamples = dispneia_resamples,
  grid = dispneia_grid_xgb,
  metrics = metric_set(roc_auc, accuracy, sensitivity, specificity),
  verbose = TRUE
  )</code></pre>
<pre class="r"><code>autoplot(dispneia_xgb_tune_grid) +
  theme_bw() +
  theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-43-1.png" width="100%" /></p>
<pre class="r"><code>collect_metrics(dispneia_xgb_tune_grid) |&gt; 
  filter(.metric == &quot;roc_auc&quot;) |&gt; 
  filter(mean == max(mean))</code></pre>
<pre><code>## # A tibble: 1 × 8
##   trees learn_rate .metric .estimator  mean     n std_err .config               
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 
## 1   190        0.1 roc_auc binary     0.820     5  0.0169 Preprocessor1_Model120</code></pre>
<pre class="r"><code>dispneia_xgb_tune_grid |&gt; 
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre><code>## # A tibble: 1 × 3
##   trees learn_rate .config               
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                 
## 1   190        0.1 Preprocessor1_Model120</code></pre>
<pre class="r"><code>show_best(dispneia_xgb_tune_grid, n = 6)</code></pre>
<pre><code>## Warning: No value of `metric` was given; metric &#39;roc_auc&#39; will be used.</code></pre>
<pre><code>## # A tibble: 6 × 8
##   trees learn_rate .metric .estimator  mean     n std_err .config               
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 
## 1   190       0.1  roc_auc binary     0.820     5  0.0169 Preprocessor1_Model120
## 2   165       0.1  roc_auc binary     0.819     5  0.0175 Preprocessor1_Model119
## 3   290       0.04 roc_auc binary     0.819     5  0.0195 Preprocessor1_Model040
## 4   265       0.06 roc_auc binary     0.819     5  0.0191 Preprocessor1_Model067
## 5   315       0.04 roc_auc binary     0.819     5  0.0196 Preprocessor1_Model041
## 6   290       0.06 roc_auc binary     0.819     5  0.0187 Preprocessor1_Model068</code></pre>
<pre class="r"><code>dispneia_best_step5 &lt;-
  dispneia_xgb_tune_grid |&gt;
  select_best(metric = &quot;roc_auc&quot;)</code></pre>
<pre class="r"><code># best hiperparameters
glue::glue(&quot;Following tunning again, the best number of trees was {dispneia_best_step5$trees} and learn_rate was {dispneia_best_step5$learn_rate}.&quot;)</code></pre>
<pre><code>## Following tunning again, the best number of trees was 190 and learn_rate was 0.1.</code></pre>
</div>
<div id="final-model-performance" class="section level3">
<h3>Final model performance</h3>
</div>
<div id="model-5" class="section level3">
<h3>Model</h3>
<pre class="r"><code># Model
dispneia_xgb_final_model &lt;-
  boost_tree(
  min_n = 11,
  mtry = 0.8,
  trees = 565,
  tree_depth = 1,
  learn_rate = 0.02,
  loss_reduction = 1.36,
  sample_size = 0.8
) |&gt;
  set_mode(&quot;classification&quot;) |&gt;
  set_engine(&quot;xgboost&quot;, count = FALSE)</code></pre>
</div>
<div id="workflow-5" class="section level3">
<h3>Workflow</h3>
<pre class="r"><code># Workflow
dispneia_xgb_final_wf &lt;- 
  workflow() |&gt; 
  add_model(dispneia_xgb_final_model) |&gt; 
  add_recipe(dispneia_recipe)</code></pre>
</div>
<div id="tuning-5" class="section level3">
<h3>Tuning</h3>
<pre class="r"><code># Tune - min_n and tree_depth
dispneia_best_params_xgb &lt;-
  expand.grid(
    min_n = 11,
    mtry = 0.8,
    trees = 565,
    tree_depth = 1,
    learn_rate = 0.02,
    loss_reduction = 1.36,
    sample_size = 0.8
)

dispneia_best_params_xgb |&gt; 
  DT::datatable()</code></pre>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7">{"x":{"filter":"none","vertical":false,"data":[["1"],[11],[0.8],[565],[1],[0.02],[1.36],[0.8]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>min_n<\/th>\n      <th>mtry<\/th>\n      <th>trees<\/th>\n      <th>tree_depth<\/th>\n      <th>learn_rate<\/th>\n      <th>loss_reduction<\/th>\n      <th>sample_size<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code># Desempenho do modelo finaL ----------------------------------------------
dispneia_xgb_final_wf &lt;- 
  dispneia_xgb_final_wf |&gt;
  finalize_workflow(dispneia_best_params_xgb)

dispneia_xgb_last_fit &lt;-
  last_fit(dispneia_xgb_final_wf, dispneia_initial_split)

collect_predictions(dispneia_xgb_last_fit) |&gt; 
  mutate(modelo = &quot;XGBoost&quot;) |&gt; 
  group_by(modelo) |&gt; 
  roc_curve(dispneia, .pred_No) |&gt; 
  autoplot() +
  theme_bw() +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<pre class="r"><code># best hiperparameters
best_roc &lt;- show_best(dispneia_xgb_last_fit)
glue::glue(&quot;The best ROC was {round(best_roc$mean,2)}!&quot;)</code></pre>
<pre><code>## The best ROC was 0.8!</code></pre>
<pre class="r"><code>dispneia_xgb_last_fit_model &lt;- dispneia_xgb_last_fit$.workflow[[1]]$fit$fit

dispneia_xgb_vip &lt;- 
  extract_fit_engine(dispneia_xgb_last_fit)

vip::vip(dispneia_xgb_vip)+
  theme_bw()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<p>Finally, XGBoost was effective to predict dyspnea in COVID-19 survivors 6-9 months after hospital discharge. Thus, XGBoost implementation in a clinical setting might aid health professionals in the early management of COVID-19 survivors at risk of future dyspnea.</p>
<p>It is noteworthy that the analyses performed herein are not intended to be used in practice. However, these analysis reinforce the utilization of ML algorithm in the health care.</p>
<p>Hope you enjoyed it!😜!</p>
<p><img src="https://us.123rf.com/450wm/alesika/alesika2008/alesika200800157/153702004-see-you-soon-inscription-handwritten-lettering-illustration-black-vector-text-in-speech-bubble-simpl.jpg?ver=6" /></p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p><a href="https://bmcpulmmed.biomedcentral.com/articles/10.1186/s12890-022-02214-5">Srazzo et al., Long-term dyspnea, regional ventilation distribution and peripheral lung function in COVID-19 survivors: a 1 year follow-up study</a></p>
<p><a href="https://www.statlearning.com/">An Introduction to Statistical Learning: with Applications in R</a></p>
</div>
